using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using UnityEngine.SceneManagement;

public class CharacterManager : MonoBehaviour {

    private List<Character_Rotate> characters = new List<Character_Rotate>();
    private Character_Rotate currentCharacter;
    private int currentIndex;
    public Text numberText;
    public Text nameText;

    #region Singleton

    public static CharacterManager instance; // variable to store the actual instance for the class object

    void Awake()
    {
        /* if object is already created */
        if (instance != null)
        {
            Debug.LogWarning("More than one instance of CharacterManager found!");
            return;
        }
        instance = this;
    }

    #endregion

    //private void OnEnable()
    //{
    //    if (NUM_OF_CHARACTERS > characters.Capacity)
    //        characters.Capacity = NUM_OF_CHARACTERS;
    //    characters.AddRange(new Character[NUM_OF_CHARACTERS - characters.Count]);
    //}

    // Use this for initialization
    void Start () {
        //DontDestroyOnLoad(this); 이 기능 나중에 singleton에 넣기 (파라미터로 받아서)

        Character_Rotate[] tempList = GetComponentsInChildren<Character_Rotate>();

        for (int i = 0; i < tempList.Length; ++i)
            characters.Add(tempList[i]);

        currentIndex = 0;
        currentCharacter = characters[currentIndex];

        for (int i = 1; i < characters.Count; ++i)
            characters[i].gameObject.SetActive(false);

        numberText.text = (currentIndex + 1).ToString() + "/" + characters.Count.ToString();
        nameText.text = currentCharacter.characterName.ToString();
    }

    // Update is called once per frame
    void Update () {
        if (Input.GetKeyDown(KeyCode.D))
        {
            OnRightArrowClicked();
        }
        else if (Input.GetKeyDown(KeyCode.A))
        {
            OnLeftArrowClicked();
        }
        else if (Input.GetKeyDown(KeyCode.Return) || Input.GetKeyDown(KeyCode.Escape))
        {
            OnSelect();
        }
	}

    void ChangeCharacterSkin()
    {
        if (currentIndex < 0 || currentIndex >= characters.Count)
        {
            Debug.LogWarning("ChangeCharacterSkin() out of index");
            return;
        }

        //if (characters[index].locked)
        //{
        //    Debug.LogWarning("ChangeCharacterSkin() invalid index access");
        //    return;
        //}

        currentCharacter.gameObject.SetActive(false);
        currentCharacter = characters[currentIndex]; // 캐릭터가 가진 정보까지 바꿔야하나? // 씬 중간에 스킨을 바꿀 경우 정보 저장까지
        currentCharacter.gameObject.SetActive(true);
        numberText.text = (currentIndex + 1).ToString() + "/" + characters.Count.ToString();
        nameText.text = currentCharacter.characterName.ToString();
    }

    public void OnLeftArrowClicked()
    {
        --currentIndex;
        if (currentIndex < 0)
            currentIndex = characters.Count - 1;

        ChangeCharacterSkin();
    }

    public void OnRightArrowClicked()
    {
        ++currentIndex;
        if (currentIndex >= characters.Count)
            currentIndex = 0;

        ChangeCharacterSkin();
    }

    public void OnSelect()
    {
        SceneManager.LoadScene("MainMenu");
    }

    public void AddCharacter(Character_Rotate character)
    {
        for (int i = 0; i < characters.Count; ++i)
        {
            if (characters[i].characterName == character.characterName)
            {
                Debug.LogWarning("Duplicated character is on the list : " + character);
                return;
            }
        }

        characters.Add(character);
    }

    public void RemoveCharacter(Character_Rotate character)
    {
        for (int i = 0; i < characters.Count; ++i)
        {
            if (characters[i].characterName == character.characterName)
            {
                characters.Remove(character);
                return;
            }
        }

        Debug.LogWarning("Character not on the list is attempted to delete : " + character);
    }
}
