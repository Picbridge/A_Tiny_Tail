using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class RankingManager : Singleton<RankingManager>
{
    private bool isObjectObtained;
    private bool gameStarted;

    public int[] levelRank;
    public float[] levelTimeStandard;
    public float timer;

    public int clearedLevelIndex;
    public int enterLevelIndex;

	void Start ()
    {
        levelRank = new int[12];
        levelTimeStandard = new float[12];

        for (int i = 0; i < levelRank.Length; i++)        
            levelRank[i] = 0;

        levelTimeStandard[0] = 1000f;
        levelTimeStandard[1] = 20f;
        levelTimeStandard[2] = 45f;
        levelTimeStandard[3] = 1000f;
        levelTimeStandard[4] = 55f;
        levelTimeStandard[5] = 55f;
        levelTimeStandard[6] = 1000f;
        levelTimeStandard[7] = 55f;
        levelTimeStandard[8] = 55f;
        levelTimeStandard[9] = 40f;
        levelTimeStandard[10] = 60f;
        levelTimeStandard[11] = 100f;

    }

    void Update()
    {        
        if (gameStarted == true)
        {            
            timer -= Time.deltaTime;
        }
    }

    public void GameStart()
    {            
        isObjectObtained = false;
        timer = levelTimeStandard[enterLevelIndex - 1];
        gameStarted = true;
    }

    public int GameEnd(int levelIndex)
    {
        int rank = 1;
        gameStarted = false;

        clearedLevelIndex = levelIndex;

        if (timer < levelTimeStandard[levelIndex - 1])        
            rank++;

        if (timer > 120f)
            CharacterSelectionManager.instance.UnlockCharacter(3); // Unlock Snail

        if (isObjectObtained == true)
            rank++;

        if(levelRank[levelIndex - 1] < rank)
             levelRank[levelIndex - 1] = rank;
       
        Debug.Log(levelRank[levelIndex - 1]);

        return rank;
    }

    public void ObtainObject()
    {
        isObjectObtained = true;
    }

    public void SetLevelIndex_(int index)
    {
        enterLevelIndex = index;
    }

    public void SetLevelIndex(string name)
    {
        if (name == "H_Tutorial")
            enterLevelIndex = 1;
        else if (name == "H_Lv1")
            enterLevelIndex = 2;
        else if (name == "H_Lv2")
            enterLevelIndex = 3;
        else if (name == "C_Tutorial")
            enterLevelIndex = 4;
        else if (name == "C_Lv1")
            enterLevelIndex = 5;
        else if (name == "C_Lv2")
            enterLevelIndex = 6;
        else if (name == "L_Tutorial")
            enterLevelIndex = 7;
        else if (name == "L_Lv1")
            enterLevelIndex = 8;
        else if (name == "L_Lv2")
            enterLevelIndex = 9;
        else if (name == "M_Lv1")
            enterLevelIndex = 10;
        else if (name == "M_Lv2")
            enterLevelIndex = 11;
        else if (name == "M_Lv3")
            enterLevelIndex = 12;
    }
}
